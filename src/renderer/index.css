@tailwind base;
@tailwind components;
@tailwind utilities;

/* 防止白屏：在 JS 未执行或加载失败时也有深色背景 */
html,
body,
#root {
  min-height: 100vh;
  background-color: #0a0a0a;
}
body {
  margin: 0;
}

/* 复制粘贴节点动画 */
@keyframes fadeInZoom {
  from {
    opacity: 0;
    transform: scale(0.9);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

.react-flow__node.pasted-node {
  animation: fadeInZoom 0.3s ease-out;
}

/* GPU 合成层优化：让节点尽量走合成阶段，减少布局/重绘压力 */
.react-flow__node {
  will-change: transform;
  backface-visibility: hidden;
  transform: translateZ(0);
}
.react-flow__node > div {
  will-change: transform;
  backface-visibility: hidden;
}

/* React Flow 边样式：拖动时虚线，连接后实线 */
.react-flow__edge:not(.rf-edge-gradient) {
  stroke-dasharray: none; /* 默认实线 */
  transition: stroke-width 0.2s ease, stroke 0.2s ease, filter 0.2s ease;
  stroke: #9CA3AF !important; /* 默认灰色，使用 !important 确保覆盖内联样式 */
}

/* 明亮模式下连接线使用灰黑色 */
.light-mode .react-flow__edge:not(.rf-edge-gradient),
.light-mode .react-flow__edge:not(.rf-edge-gradient) path {
  stroke: #374151 !important; /* 灰黑色，使用 !important 确保覆盖内联样式 */
}

/* 暗黑模式下连接线使用灰色 */
.dark-mode .react-flow__edge:not(.rf-edge-gradient),
.dark-mode .react-flow__edge:not(.rf-edge-gradient) path {
  stroke: #9CA3AF !important; /* 灰色，使用 !important 确保覆盖内联样式 */
}

/* 正在拖动的连接线（临时边）使用虚线 */
.react-flow__edge.interactive.react-flow__edge-connecting {
  stroke-dasharray: 5 5;
  stroke: #9CA3AF !important; /* 默认灰色，使用 !important 确保覆盖内联样式 */
}

/* 明亮模式下正在拖动的连接线使用灰黑色 */
.light-mode .react-flow__edge.interactive.react-flow__edge-connecting:not(.rf-edge-gradient),
.light-mode .react-flow__edge.interactive.react-flow__edge-connecting:not(.rf-edge-gradient) path {
  stroke: #374151 !important; /* 灰黑色，使用 !important 确保覆盖内联样式 */
}

/* 已连接的边使用实线 */
.react-flow__edge.selected:not(.rf-edge-gradient),
.react-flow__edge:not(.react-flow__edge-connecting):not(.rf-edge-gradient) {
  stroke-dasharray: none;
}

/* 选中的边高亮显示：绿色带光晕效果（仅在光明模式下） */
.react-flow__edge.selected:not(.rf-edge-gradient) {
  stroke-width: 3;
  stroke: #22c55e; /* 绿色高亮 */
}

/* 暗黑模式下选中的边不显示光晕效果 */
.dark-mode .react-flow__edge.selected:not(.rf-edge-gradient) {
  filter: none;
}

/* 光明模式下选中的边显示光晕效果 */
.light-mode .react-flow__edge.selected:not(.rf-edge-gradient) {
  filter: drop-shadow(0 0 6px rgba(34, 197, 94, 0.6)) drop-shadow(0 0 12px rgba(34, 197, 94, 0.4));
}

/* 向上滑出动画 */
@keyframes slide-up {
  from {
    transform: translate(-50%, 100%);
    opacity: 0;
  }
  to {
    transform: translate(-50%, 0);
    opacity: 1;
  }
}

.animate-slide-up {
  animation: slide-up 0.3s ease-out;
}

/* 旋转加载动画 */
@keyframes spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

.animate-spin {
  animation: spin 1s linear infinite;
}

body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
    sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  background-color: #000000;
}

#root {
  width: 100%;
  height: 100vh;
  background-color: #000000;
}

/* Apple Dark Mode 面板样式 */
.apple-panel {
  background: rgba(28, 28, 30, 0.7);
  backdrop-filter: blur(12px) saturate(150%);
  -webkit-backdrop-filter: blur(12px) saturate(150%);
  border: 1px solid rgba(255, 255, 255, 0.1);
}

@supports not (backdrop-filter: blur(12px)) {
  .apple-panel {
    background: rgba(28, 28, 30, 0.9);
  }
}

/* Apple Light Mode 面板样式 - 白灰色模块与侧面框 */
.apple-panel-light {
  background: rgba(245, 245, 245, 0.95); /* 白灰色 #f5f5f5 */
  backdrop-filter: blur(12px) saturate(150%);
  -webkit-backdrop-filter: blur(12px) saturate(150%);
  border: 1px solid rgba(220, 220, 220, 0.6);
}

@supports not (backdrop-filter: blur(12px)) {
  .apple-panel-light {
    background: rgba(245, 245, 245, 0.98);
  }
}

/* Apple Dark Mode 按钮样式 */
.apple-button-primary {
  background: #0A84FF;
  color: #ffffff;
}

.apple-button-secondary {
  background: rgba(28, 28, 30, 0.7);
  backdrop-filter: blur(12px) saturate(150%);
  -webkit-backdrop-filter: blur(12px) saturate(150%);
  border: 1px solid rgba(255, 255, 255, 0.1);
  color: #ffffff;
}

.apple-button-secondary:hover {
  background: rgba(255, 255, 255, 0.15);
}

/* 呼吸灯动画 */
@keyframes breathe {
  0%, 100% {
    box-shadow: 0 0 0 0 rgba(10, 132, 255, 0.4);
  }
  50% {
    box-shadow: 0 0 0 8px rgba(10, 132, 255, 0);
  }
}

.animate-pulse {
  animation: breathe 2s ease-in-out infinite;
}

/* 淡入动画 */
@keyframes fade-in {
  from {
    opacity: 0;
    transform: translateY(-4px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.animate-fade-in {
  animation: fade-in 0.2s ease-out;
}

/* 自定义滚动条样式 - 灰色椭圆形较窄 */
.custom-scrollbar::-webkit-scrollbar {
  width: 6px;
  height: 6px;
}

.custom-scrollbar::-webkit-scrollbar-track {
  background: transparent;
}

.custom-scrollbar::-webkit-scrollbar-thumb {
  background: rgba(156, 163, 175, 0.5);
  border-radius: 10px;
}

.custom-scrollbar::-webkit-scrollbar-thumb:hover {
  background: rgba(156, 163, 175, 0.7);
}

/* Firefox 滚动条 */
.custom-scrollbar {
  scrollbar-width: thin;
  scrollbar-color: rgba(156, 163, 175, 0.5) transparent;
}

/* 菜单展开动画 */
@keyframes menu-expand {
  from {
    opacity: 0;
    transform: scale(0.95) translateY(-8px);
  }
  to {
    opacity: 1;
    transform: scale(1) translateY(0);
  }
}

.animate-menu-expand {
  animation: menu-expand 0.2s ease-out;
}

/* 进度条循环动画：绿色块从左滑到右后重置 */
@keyframes progress-bar-slide {
  0% {
    transform: translateX(-100%);
  }
  100% {
    transform: translateX(400%);
  }
}

.progress-bar-indeterminate {
  animation: progress-bar-slide 1.8s ease-in-out infinite;
}

/* 全模块进度条：永动机式循环动画（0% → 100% 匀速，瞬间重置） */
@keyframes loopProgress {
  from {
    width: 0%;
  }
  to {
    width: 100%;
  }
}

.module-progress-fill {
  height: 100%;
  background: linear-gradient(90deg, #22c55e 0%, #22c55e 60%, rgba(34, 197, 94, 0.35) 100%);
  animation: loopProgress 3s linear infinite;
  will-change: width;
  border-radius: 4px;
}

/* 全模块进度条：流动光效（从左向右） */
@keyframes module-progress-shine {
  0% {
    background-position: 0 0;
  }
  100% {
    background-position: 24px 0;
  }
}

/* 禁止画布区域的文本和图片被浏览器默认选中 */
.react-flow__pane,
.react-flow__node,
.react-flow__edge {
  user-select: none;
  -webkit-user-select: none;
}

.react-flow__node img {
  user-drag: none;
  -webkit-user-drag: none;
}

/* 不兼容模块：红框画在节点内容层上，尺寸与圆角与模块一致；选中且不兼容时优先显示红框 */
.react-flow__node.connection-invalid-target > div {
  box-shadow: 0 0 0 2px #ef4444 !important;
  border-radius: 12px;
}
.react-flow__node.selected.connection-invalid-target > div {
  box-shadow: 0 0 0 2px #ef4444 !important;
  border-color: transparent;
  outline: none;
  --tw-ring-shadow: none;
}
.react-flow-wrapper--interacting .react-flow__node.connection-invalid-target > div {
  box-shadow: 0 0 0 2px #ef4444 !important;
}
/* 智能性能模式下不兼容目标仍显示红框 */
.pf-performance-mode .react-flow__node.connection-invalid-target > div {
  box-shadow: 0 0 0 2px #ef4444 !important;
}

/* LLMInputPanel 毛玻璃效果 */
.llm-panel-glass {
  background: rgba(229, 231, 235, 0.9);
  backdrop-filter: blur(12px) saturate(150%);
  -webkit-backdrop-filter: blur(12px) saturate(150%);
}

/* 光标颜色（必须通过内联样式设置，这里仅作为备用） */
.caret-color-dark {
  caret-color: #0A84FF;
}

.caret-color-light {
  caret-color: #22c55e;
}

/* 确保 React Flow viewport 的 transform-origin 由 React Flow 动态控制 */
.react-flow__viewport {
  /* 不手动设置 transform-origin，让 React Flow 自动处理 */
  /* transform-origin 应该由 React Flow 根据鼠标位置动态计算 */
}

/* 选中节点：无光晕，仅绿框（与 3D 视角控制器一致） */

/* 拖拽/缩放画布时暂时去掉阴影与发光，减轻重绘 */
.react-flow-wrapper--interacting .react-flow__node {
  filter: none !important;
  box-shadow: none !important;
}
.react-flow-wrapper--interacting .react-flow__node.selected {
  filter: none !important;
  box-shadow: none !important;
}

/* 缩放/平移交互期间：连线降级到 1px 且关闭过渡，减少路径重绘成本 */
.react-flow-wrapper--interacting .react-flow__edge:not(.rf-edge-gradient),
.react-flow-wrapper--interacting .react-flow__edge:not(.rf-edge-gradient) path {
  transition: none !important;
  stroke-width: 1 !important;
  filter: none !important;
}

/* 智能性能模式：全局降级阴影/滤镜与过渡，减少重绘 */
.pf-performance-mode .react-flow__node,
.pf-performance-mode .react-flow__node.selected {
  box-shadow: none !important;
  filter: none !important;
  transition: none !important;
}
.pf-performance-mode .react-flow__edge:not(.rf-edge-gradient),
.pf-performance-mode .react-flow__edge:not(.rf-edge-gradient) path {
  transition: none !important;
  stroke-width: 1px !important;
  filter: none !important;
}

/* 空白画布入场：水波纹动感（一次性） */
@keyframes dot-water-ripple {
  0% {
    opacity: 0;
    transform: translate(-50%, -50%) scale(0.16);
  }
  18% {
    opacity: 0.42;
  }
  100% {
    opacity: 0;
    transform: translate(-50%, -50%) scale(1.95);
  }
}

@keyframes dot-water-core {
  0% {
    opacity: 0;
    transform: translate(-50%, -50%) scale(0.55);
  }
  22% {
    opacity: 0.34;
  }
  100% {
    opacity: 0;
    transform: translate(-50%, -50%) scale(1.35);
  }
}

.react-flow__background-wave-intro {
  position: absolute;
  inset: 0;
  z-index: -1;
  pointer-events: none;
  overflow: hidden;
  will-change: opacity;
}

.react-flow__background-wave-intro::before {
  content: '';
  position: absolute;
  left: 50%;
  top: 50%;
  width: 380px;
  height: 380px;
  border-radius: 999px;
  transform: translate(-50%, -50%);
  animation: dot-water-core 1200ms cubic-bezier(0.18, 0.7, 0.2, 1) 1 both;
  filter: blur(0.6px);
}

.react-flow__background-wave-ring {
  position: absolute;
  left: 50%;
  top: 50%;
  width: 210px;
  height: 210px;
  border-radius: 999px;
  border: 1.5px solid transparent;
  transform: translate(-50%, -50%) scale(0.2);
  animation: dot-water-ripple 1300ms cubic-bezier(0.2, 0.7, 0.2, 1) 1 both;
  will-change: transform, opacity;
}

.react-flow__background-wave-ring.wave-ring-2 {
  animation-delay: 140ms;
}

.react-flow__background-wave-ring.wave-ring-3 {
  animation-delay: 280ms;
}

.react-flow__background-wave-intro.dark {
  background: radial-gradient(circle at center, rgba(255, 255, 255, 0.08) 0%, rgba(255, 255, 255, 0.03) 35%, transparent 70%);
}

.react-flow__background-wave-intro.dark::before {
  background: radial-gradient(circle at center, rgba(255, 255, 255, 0.22) 0%, rgba(255, 255, 255, 0.08) 42%, transparent 72%);
}

.react-flow__background-wave-intro.dark .react-flow__background-wave-ring {
  border-color: rgba(255, 255, 255, 0.28);
  box-shadow: 0 0 14px rgba(255, 255, 255, 0.08);
}

.react-flow__background-wave-intro.light {
  background: radial-gradient(circle at center, rgba(0, 0, 0, 0.06) 0%, rgba(0, 0, 0, 0.025) 34%, transparent 70%);
}

.react-flow__background-wave-intro.light::before {
  background: radial-gradient(circle at center, rgba(0, 0, 0, 0.14) 0%, rgba(0, 0, 0, 0.05) 46%, transparent 72%);
}

.react-flow__background-wave-intro.light .react-flow__background-wave-ring {
  border-color: rgba(0, 0, 0, 0.2);
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.06);
}

/* 深色音频播放器样式 */
/* 暗黑模式音频播放器样式 */
audio.audio-dark {
  filter: invert(1) hue-rotate(180deg);
}

audio.audio-dark::-webkit-media-controls-panel {
  background-color: #1C1C1E !important;
  border-radius: 8px;
  padding: 8px;
}

/* 确保音频播放器背景与模块颜色一致 */
audio.audio-dark::-webkit-media-controls-enclosure {
  background-color: #1C1C1E !important;
  border-radius: 8px;
}

audio.audio-dark::-webkit-media-controls-play-button,
audio.audio-dark::-webkit-media-controls-pause-button {
  filter: invert(1) hue-rotate(180deg);
  background-color: rgba(255, 255, 255, 0.1);
  border-radius: 4px;
}

audio.audio-dark::-webkit-media-controls-mute-button {
  filter: invert(1) hue-rotate(180deg);
}

audio.audio-dark::-webkit-media-controls-volume-slider {
  filter: invert(1) hue-rotate(180deg);
}

audio.audio-dark::-webkit-media-controls-timeline {
  filter: invert(1) hue-rotate(180deg);
  background-color: rgba(255, 255, 255, 0.2);
  border-radius: 2px;
}

audio.audio-dark::-webkit-media-controls-current-time-display,
audio.audio-dark::-webkit-media-controls-time-remaining-display {
  filter: invert(1) hue-rotate(180deg);
  color: rgba(255, 255, 255, 0.9);
}

/* 明亮模式音频播放器样式 */
audio:not(.audio-dark)::-webkit-media-controls-panel {
  background-color: #f3f4f6;
  border-radius: 8px;
  padding: 8px;
}

audio:not(.audio-dark)::-webkit-media-controls-timeline {
  background-color: rgba(0, 0, 0, 0.1);
  border-radius: 2px;
}
